<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright (C) 2011-2019 Talend Inc.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

         http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.talend.esb</groupId>
        <artifactId>esb-parent</artifactId>
        <version>7.3.1.R2022-09-RT</version>
    </parent>

    <groupId>org.talend.esb.assembly</groupId>
    <artifactId>talend-esb</artifactId>
    <name>Talend ESB :: Assembly</name>
    <packaging>pom</packaging>
    <description>Packages TESB_SE final product</description>

    <properties>
        <!-- used for version.txt -->
        <build.number>local</build.number>
        <tag_label />
        <!-- used for assembly & dependency type, overwritten by dev-unix-assembly-only & dev-win-assembly-only profiles -->
        <assembly.formats>tar.gz,zip</assembly.formats>
        <activemq.tesb.version>5.15.15</activemq.tesb.version>
        <pax-logging.tesb.version>1.11.15</pax-logging.tesb.version>
        <!-- version updates from the patch -->
        <standard.features.tesb.version>4.2.7.tesb13</standard.features.tesb.version>
        <enterprise.features.tesb.version>4.2.7.tesb4</enterprise.features.tesb.version>
        <enterprise-legacy.features.tesb.version>4.2.7.tesb1</enterprise-legacy.features.tesb.version>
        <framework.features.tesb.version>4.2.7.tesb5</framework.features.tesb.version>
        <spring.features.tesb.version>4.2.7.tesb5</spring.features.tesb.version>
        <apache-cxf.features.tesb.version>3.4.7.tesb2</apache-cxf.features.tesb.version>
        <apache-cxf-xkms.features.tesb.version>3.4.7.tesb1</apache-cxf-xkms.features.tesb.version>
        <apache-camel.features.tesb.version>2.25.4.tesb2</apache-camel.features.tesb.version>
        <pax-web.features.tesb.version>7.2.30.tesb1</pax-web.features.tesb.version>
        <activemq.features.tesb.version>5.15.15.tesb5</activemq.features.tesb.version>
        <hibernate-validator.features.tesb.version>6.0.17.Final.tesb2</hibernate-validator.features.tesb.version>
        <jobserver.version>7.3.1.20220207_1020_patch</jobserver.version>
        <tdm.version>7.3.1.20220408</tdm.version>

        <karaf-maven-plugin.version>4.2.12</karaf-maven-plugin.version>
        <pax-cdi.features.tesb.version>1.1.4</pax-cdi.features.tesb.version>
        <pax-jdbc.features.tesb.version>1.4.0</pax-jdbc.features.tesb.version>
        <pax-jms.features.tesb.version>1.0.5</pax-jms.features.tesb.version>
        <pax-transx.features.tesb.version>0.4.4</pax-transx.features.tesb.version>
        <jpa.features.tesb.version>2.7.2</jpa.features.tesb.version>
        <openjpa.features.tesb.version>3.0.0</openjpa.features.tesb.version>
        <decanter.features.tesb.version>2.2.0.tesb3</decanter.features.tesb.version>
        <hibernate.features.tesb.version>5.2.17.Final</hibernate.features.tesb.version>
        <hapi-fhir.features.tesb.version>3.5.0</hapi-fhir.features.tesb.version>
    </properties>

    <dependencies>
        <dependency>
            <groupId>org.talend.esb.sts</groupId>
            <artifactId>cxf-sts-war</artifactId>
            <version>${project.version}</version>
            <type>war</type>
        </dependency>
        <!-- workaround for pax-url-classpath bundle (TESB-6904) -->
        <dependency>
            <groupId>org.ops4j.pax.url</groupId>
            <artifactId>pax-url-classpath</artifactId>
            <version>${pax-url-classpath.version}</version>
            <type>jar</type>
        </dependency>
    </dependencies>

    <build>
        <resources>
            <resource>
                <directory>${project.basedir}/src/main/filtered-resources</directory>
                <filtering>true</filtering>
                <includes>
                    <include>**/*</include>
                </includes>
            </resource>
            <resource>
                <directory>${project.basedir}/bin</directory>
                <filtering>true</filtering>
                <targetPath>bin</targetPath>
            </resource>
        </resources>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-resources-plugin</artifactId>
                <executions>
                    <execution>
                        <id>filter</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>resources</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.karaf.tooling</groupId>
                <artifactId>karaf-maven-plugin</artifactId>
                <version>${karaf-maven-plugin.version}</version>
                <extensions>true</extensions>
                <executions>
                    <execution>
                        <id>custom-features</id>
                        <phase>process-resources</phase>
                        <goals>
                            <goal>features-add-to-repository</goal>
                        </goals>
                        <configuration>
                            <descriptors>
                                <descriptor>file:${basedir}/target/dependencies/apache-camel-${camel.version}-features.xml</descriptor>
                            </descriptors>
                            <features>
                                <feature>camel-groovy</feature>
                                <feature>camel-script-groovy</feature>
                            </features>
                        </configuration>
                    </execution>
                    <execution>
                        <id>add-features-to-repo</id>
                        <phase>process-resources</phase>
                        <goals>
                            <goal>features-add-to-repository</goal>
                        </goals>
                        <configuration>
                            <descriptors>
                                <descriptor>mvn:org.apache.karaf.features/standard/${standard.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.apache.karaf.features/spring/${spring.features.tesb.version}/xml/features</descriptor>
                                <descriptor>file:${basedir}/target/dependencies/spring-legacy-${karaf.version}-features.xml</descriptor>
                                <descriptor>mvn:org.apache.karaf.features/enterprise/${enterprise.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.apache.karaf.features/enterprise-legacy/${enterprise-legacy.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.apache.karaf.features/framework/${framework.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.apache.jclouds.karaf/jclouds-karaf/${jclouds.version}/xml/features</descriptor>
                                <descriptor>mvn:org.apache.karaf.decanter/apache-karaf-decanter/${decanter.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.ops4j.pax.web/pax-web-features/${pax-web.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.apache.cxf.karaf/apache-cxf/${apache-cxf.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.apache.cxf.services.xkms/cxf-services-xkms-features/${apache-cxf-xkms.features.tesb.version}/xml</descriptor>
                                <descriptor>mvn:org.apache.activemq/activemq-karaf/${activemq.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.apache.camel.karaf/apache-camel/${apache-camel.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.talend.esb/features/${project.version}/xml</descriptor>
                                <descriptor>mvn:org.talend.esb.auxiliary.storage/auxiliary-storage-features/${project.version}/xml</descriptor>

                                <descriptor>mvn:org.hibernate.validator/hibernate-validator-osgi-karaf-features/${hibernate-validator.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.ops4j.pax.cdi/pax-cdi-features/${pax-cdi.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.ops4j.pax.jdbc/pax-jdbc-features/${pax-jdbc.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.ops4j.pax.jms/pax-jms-features/${pax-jms.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.ops4j.pax.transx/pax-transx-features/${pax-transx.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.apache.aries.jpa/jpa-features/${jpa.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.apache.openjpa/openjpa-features/${openjpa.features.tesb.version}/xml/features</descriptor>
                                <descriptor>mvn:org.apache.activemq/activemq-karaf/${activemq.features.tesb.version}/xml/features-core</descriptor>
                                <descriptor>mvn:org.hibernate/hibernate-osgi/${hibernate.features.tesb.version}/xml/karaf</descriptor>
                                <descriptor>mvn:ca.uhn.hapi.fhir.karaf/hapi-fhir/${hapi-fhir.features.tesb.version}/xml/features</descriptor>
                            </descriptors>
                            <features>
                                <!-- list of features to ignore -->
                                <feature>^(?!(camel-cdi|cxf-jaxrs-cdi|camel-ignite|camel-json-validator|camel-zookeeper-master|pax-jms-artemis|activemq-camel|pax-cdi)$).*</feature>
                            </features>
                            <repository>target/features-repo</repository>
                            <addTransitiveFeatures>false</addTransitiveFeatures>
                            <resolveDefinedRepositoriesRecursively>false</resolveDefinedRepositoriesRecursively>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-dependency-plugin</artifactId>
                <executions>
                    <execution>
                        <id>copy</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>copy</goal>
                        </goals>
                        <configuration>
                            <artifactItems>
                                <!-- cfg files -->
                                <artifactItem>
                                    <groupId>org.talend.esb</groupId>
                                    <artifactId>locator</artifactId>
                                    <version>${project.version}</version>
                                    <type>cfg</type>
                                    <classifier>org.talend.esb.locator</classifier>
                                    <outputDirectory>target/dependencies/etc</outputDirectory>
                                    <destFileName>org.talend.esb.locator.cfg</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.talend.esb</groupId>
                                    <artifactId>sam-agent</artifactId>
                                    <version>${project.version}</version>
                                    <type>cfg</type>
                                    <classifier>org.talend.esb.sam.agent</classifier>
                                    <outputDirectory>target/dependencies/etc</outputDirectory>
                                    <destFileName>org.talend.esb.sam.agent.cfg</destFileName>
                                </artifactItem>
                                <!-- workarounds for Camel features descriptor -->
                                <artifactItem>
                                    <groupId>org.apache.camel.karaf</groupId>
                                    <artifactId>apache-camel</artifactId>
                                    <version>${apache-camel.features.tesb.version}</version>
                                    <type>xml</type>
                                    <classifier>features</classifier>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>apache-camel-${camel.version}-features.xml</destFileName>
                                </artifactItem>
                                <!-- workarounds for CXF features descriptor -->
                                <artifactItem>
                                    <groupId>org.apache.cxf.karaf</groupId>
                                    <artifactId>apache-cxf</artifactId>
                                    <version>${apache-cxf.features.tesb.version}</version>
                                    <type>xml</type>
                                    <classifier>features</classifier>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>apache-cxf-${cxf.version}-features.xml</destFileName>
                                </artifactItem>
                                <!-- patch for xalan and xerces version -->
                                <!--artifactItem>
                                    <groupId>org.apache.servicemix.bundles</groupId>
                                    <artifactId>org.apache.servicemix.bundles.xalan</artifactId>
                                    <version>${xalan.version}</version>
                                    <type>jar</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem-->
                                <artifactItem>
                                    <groupId>org.apache.servicemix.bundles</groupId>
                                    <artifactId>org.apache.servicemix.bundles.xerces</artifactId>
                                    <version>${xerces.version}</version>
                                    <type>jar</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                               <!-- workaround for pax-url-classpath bundle (TESB-6904) -->
                                <artifactItem>
                                     <groupId>org.ops4j.pax.url</groupId>
                                     <artifactId>pax-url-classpath</artifactId>
                                     <version>${pax-url-classpath.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <!-- Workaround for Karaf libraries in features -->
                                <artifactItem>
                                    <groupId>org.apache.karaf.features</groupId>
                                    <artifactId>standard</artifactId>
                                    <version>${standard.features.tesb.version}</version>
                                    <type>xml</type>
                                    <classifier>features</classifier>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>standard-${karaf.version}-features.xml</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.karaf.features</groupId>
                                    <artifactId>framework</artifactId>
                                    <version>${framework.features.tesb.version}</version>
                                    <type>xml</type>
                                    <classifier>features</classifier>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>framework-${karaf.version}-features.xml</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.karaf.diagnostic</groupId>
                                    <artifactId>org.apache.karaf.diagnostic.boot</artifactId>
                                    <version>${karaf.version}</version>
                                    <type>jar</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>org.apache.karaf.diagnostic.boot-${karaf.version}.jar</destFileName>
                                </artifactItem>
                               <artifactItem>
                                    <groupId>org.apache.karaf.jaas</groupId>
                                    <artifactId>org.apache.karaf.jaas.boot</artifactId>
                                    <version>${karaf.version}</version>
                                    <type>jar</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>org.apache.karaf.jaas.boot-${karaf.version}.jar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.activemq</groupId>
                                    <artifactId>activemq-karaf</artifactId>
                                    <version>${activemq.features.tesb.version}</version>
                                    <type>xml</type>
                                    <classifier>features</classifier>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>activemq-karaf-${activemq.version}-features.xml</destFileName>
                                </artifactItem>
                                <!-- Patch jackson version (TESB-24693) -->
                                <artifactItem>
                                    <groupId>org.apache.karaf.features</groupId>
                                    <artifactId>enterprise</artifactId>
                                    <version>${enterprise.features.tesb.version}</version>
                                    <classifier>features</classifier>
                                    <type>xml</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>enterprise-${karaf.version}-features.xml</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.karaf.features</groupId>
                                    <artifactId>spring</artifactId>
                                    <version>${spring.features.tesb.version}</version>
                                    <classifier>features</classifier>
                                    <type>xml</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>spring-${karaf.version}-features.xml</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.karaf.features</groupId>
                                    <artifactId>spring-legacy</artifactId>
                                    <version>${karaf.version}</version>
                                    <classifier>features</classifier>
                                    <type>xml</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>spring-legacy-${karaf.version}-features.xml</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.activemq</groupId>
                                    <artifactId>activemq-karaf</artifactId>
                                    <version>${activemq.features.tesb.version}</version>
                                    <type>xml</type>
                                    <classifier>features-core</classifier>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>activemq-karaf-${activemq.version}-features-core.xml</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.ops4j.pax.web</groupId>
                                    <artifactId>pax-web-features</artifactId>
                                    <version>${pax-web.features.tesb.version}</version>
                                    <type>xml</type>
                                    <classifier>features</classifier>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>pax-web-features-${pax-web.version}-features.xml</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.ops4j.pax.cdi</groupId>
                                    <artifactId>pax-cdi-features</artifactId>
                                    <version>${pax-cdi.features.tesb.version}</version>
                                    <type>xml</type>
                                    <classifier>features</classifier>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>pax-cdi-features-${pax-cdi.version}-features.xml</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.ops4j.pax.jdbc</groupId>
                                    <artifactId>pax-jdbc-features</artifactId>
                                    <version>${pax-jdbc.features.tesb.version}</version>
                                    <type>xml</type>
                                    <classifier>features</classifier>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>pax-jdbc-features-${pax-jdbc.version}-features.xml</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.cxf</groupId>
                                    <artifactId>cxf-core</artifactId>
                                    <version>${cxf.version}</version>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>cxf-core-${cxf.version}.jar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.cxf</groupId>
                                    <artifactId>cxf-rt-transports-http</artifactId>
                                    <version>${cxf.version}</version>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>cxf-rt-transports-http-${cxf.version}.jar</destFileName>
                                </artifactItem>
                                <!-- patch for decanter bundles (TESB-24788) -->
                                <artifactItem>
                                    <groupId>org.apache.karaf.decanter</groupId>
                                    <artifactId>apache-karaf-decanter</artifactId>
                                    <version>${decanter.features.tesb.version}</version>
                                    <type>xml</type>
                                    <classifier>features</classifier>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>apache-karaf-decanter-${decanter.version}-features.xml</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.karaf.decanter.appender</groupId>
                                    <artifactId>org.apache.karaf.decanter.appender.jms</artifactId>
                                    <version>${decanter.version}.tesb1</version>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>org.apache.karaf.decanter.appender.jms-${decanter.version}.tesb1.jar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.karaf.decanter.appender</groupId>
                                    <artifactId>org.apache.karaf.decanter.appender.jms</artifactId>
                                    <version>${decanter.version}.tesb1</version>
                                    <type>cfg</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>org.apache.karaf.decanter.appender.jms-${decanter.version}.tesb1.cfg</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.karaf.decanter.collector</groupId>
                                    <artifactId>org.apache.karaf.decanter.collector.jms</artifactId>
                                    <version>${decanter.version}.tesb1</version>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>org.apache.karaf.decanter.collector.jms-${decanter.version}.tesb1.jar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.karaf.decanter.collector</groupId>
                                    <artifactId>org.apache.karaf.decanter.collector.jms</artifactId>
                                    <version>${decanter.version}.tesb1</version>
                                    <type>cfg</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                    <destFileName>org.apache.karaf.decanter.collector.jms-${decanter.version}.tesb1.cfg</destFileName>
                                </artifactItem>
                               <!-- upgrade Jackson version (TESB-27613) -->
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.core</groupId>
                                     <artifactId>jackson-core</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.core</groupId>
                                     <artifactId>jackson-databind</artifactId>
                                     <version>${jackson-databind.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.core</groupId>
                                     <artifactId>jackson-annotations</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.dataformat</groupId>
                                     <artifactId>jackson-dataformat-cbor</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.dataformat</groupId>
                                     <artifactId>jackson-dataformat-csv</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.dataformat</groupId>
                                     <artifactId>jackson-dataformat-smile</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.dataformat</groupId>
                                     <artifactId>jackson-dataformat-xml</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.dataformat</groupId>
                                     <artifactId>jackson-dataformat-yaml</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.datatype</groupId>
                                     <artifactId>jackson-datatype-guava</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.datatype</groupId>
                                     <artifactId>jackson-datatype-jdk8</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.datatype</groupId>
                                     <artifactId>jackson-datatype-jsr310</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.jaxrs</groupId>
                                     <artifactId>jackson-jaxrs-base</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.jaxrs</groupId>
                                     <artifactId>jackson-jaxrs-json-provider</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.jr</groupId>
                                     <artifactId>jackson-jr-objects</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.module</groupId>
                                     <artifactId>jackson-module-afterburner</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.module</groupId>
                                     <artifactId>jackson-module-jaxb-annotations</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.module</groupId>
                                     <artifactId>jackson-module-jsonSchema</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.module</groupId>
                                     <artifactId>jackson-module-paranamer</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.fasterxml.jackson.module</groupId>
                                     <artifactId>jackson-module-scala_2.11</artifactId>
                                     <version>${jackson.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <!-- START Override Quartz/C3p0 in Camel - can be removed when we pick up Camel 2.24.3+/2.25.x -->
                                <artifactItem>
                                     <groupId>org.quartz-scheduler</groupId>
                                     <artifactId>quartz</artifactId>
                                     <version>${quartz.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.c3p0</artifactId>
                                     <version>${c3p0.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>com.zaxxer</groupId>
                                     <artifactId>HikariCP-java7</artifactId>
                                     <version>${hikaricp.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <!-- END Override Quartz/C3p0 in Camel - can be removed when we pick up Camel 2.24.3+/2.25.x -->
                                <artifactItem>
                                    <groupId>org.apache.karaf.config</groupId>
                                    <artifactId>org.apache.karaf.config.core</artifactId>
                                    <version>${org.apache.karaf.config.core.tesb.version}</version>
                                    <type>jar</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.activemq</groupId>
                                    <artifactId>activemq-client</artifactId>
                                    <version>${activemq.tesb.version}</version>
                                    <type>jar</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.activemq</groupId>
                                    <artifactId>activemq-broker</artifactId>
                                    <version>${activemq.tesb.version}</version>
                                    <type>jar</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.activemq</groupId>
                                    <artifactId>activemq-karaf</artifactId>
                                    <version>${activemq.tesb.version}</version>
                                    <type>jar</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.activemq</groupId>
                                    <artifactId>activemq-osgi</artifactId>
                                    <version>${activemq.tesb.version}</version>
                                    <type>jar</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.activemq</groupId>
                                    <artifactId>activemq-web-console</artifactId>
                                    <version>${activemq.tesb.version}</version>
                                    <type>war</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.ops4j.pax.logging</groupId>
                                    <artifactId>pax-logging-log4j2</artifactId>
                                    <version>${pax-logging.tesb.version}</version>
                                    <type>jar</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.ops4j.pax.logging</groupId>
                                    <artifactId>pax-logging-log4j2-extra</artifactId>
                                    <version>${pax-logging.tesb.version}</version>
                                    <type>jar</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <!-- TESB-28029 - remove when we pick up Karaf 4.2.9 -->
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-core</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-expression</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-beans</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-aop</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-context</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-context-support</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-aspects</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-instrument</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-jdbc</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-jms</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-messaging</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-test</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-orm</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-oxm</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-tx</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-web</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-webmvc</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                     <groupId>org.apache.servicemix.bundles</groupId>
                                     <artifactId>org.apache.servicemix.bundles.spring-websocket</artifactId>
                                     <version>${spring.bundle.version}</version>
                                     <type>jar</type>
                                     <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                                <!-- TESB-28029 end -->
                                <artifactItem>
                                    <groupId>org.apache.cxf</groupId>
                                    <artifactId>cxf-rt-rs-service-description-swagger</artifactId>
                                    <version>${cxf-rt-rs-service-description-swagger.tesb.version}</version>
                                    <type>jar</type>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                </artifactItem>
                            </artifactItems>
                        </configuration>
                    </execution>
                    <execution>
                        <id>copy-endorsed</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>copy</goal>
                        </goals>
                        <configuration>
                            <outputDirectory>target/container/lib/endorsed</outputDirectory>
                            <artifactItems>
                                <artifactItem>
                                    <groupId>com.sun.istack</groupId>
                                    <artifactId>istack-commons-runtime</artifactId>
                                    <version>3.0.7</version>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>com.sun.activation</groupId>
                                    <artifactId>jakarta.activation</artifactId>
                                    <version>1.2.1</version>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>jakarta.xml.soap</groupId>
                                    <artifactId>jakarta.xml.soap-api</artifactId>
                                    <version>1.4.1</version>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.servicemix.bundles</groupId>
                                    <artifactId>org.apache.servicemix.bundles.jaxb-runtime</artifactId>
                                    <version>2.3.1_1</version>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.servicemix.bundles</groupId>
                                    <artifactId>org.apache.servicemix.bundles.jaxb-xjc</artifactId>
                                    <version>2.3.1_1</version>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.servicemix.bundles</groupId>
                                    <artifactId>org.apache.servicemix.bundles.saaj-impl</artifactId>
                                    <version>1.3.23_2</version>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.servicemix.bundles</groupId>
                                    <artifactId>org.apache.servicemix.bundles.xerces</artifactId>
                                    <version>2.12.0_1</version>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.servicemix.specs</groupId>
                                    <artifactId>org.apache.servicemix.specs.jaxb-api-2.3</artifactId>
                                    <version>2.3_1</version>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.jvnet.staxex</groupId>
                                    <artifactId>stax-ex</artifactId>
                                    <version>1.8.1</version>
                                </artifactItem>
                            </artifactItems>
                        </configuration>
                    </execution>
                    <execution>
                        <id>copy-jdk9plus</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>copy</goal>
                        </goals>
                        <configuration>
                            <outputDirectory>target/container/lib/jdk9plus</outputDirectory>
                            <artifactItems>
                                <artifactItem>
                                    <groupId>jakarta.xml.soap</groupId>
                                    <artifactId>jakarta.xml.soap-api</artifactId>
                                    <version>1.4.1</version>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.servicemix.bundles</groupId>
                                    <artifactId>org.apache.servicemix.bundles.saaj-impl</artifactId>
                                    <version>1.5.1_1</version>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.servicemix.bundles</groupId>
                                    <artifactId>org.apache.servicemix.bundles.xerces</artifactId>
                                    <version>2.12.0_1</version>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.jvnet.staxex</groupId>
                                    <artifactId>stax-ex</artifactId>
                                    <version>1.8.1</version>
                                </artifactItem>
                            </artifactItems>
                        </configuration>
                    </execution>
                    <execution>
                        <id>unpack-karaf</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>unpack</goal>
                        </goals>
                        <configuration>
                            <artifactItems>
                                <artifactItem>
                                    <groupId>org.apache.karaf</groupId>
                                    <artifactId>apache-karaf</artifactId>
                                    <version>${karaf.version}</version>
                                    <type>tar.gz</type>
                                    <outputDirectory>target/dependencies/apache-karaf</outputDirectory>
                                </artifactItem>
                            </artifactItems>
                        </configuration>
                    </execution>
                    <execution>
                        <id>unpack-camel</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>unpack</goal>
                        </goals>
                        <configuration>
                            <artifactItems>
                                <artifactItem>
                                    <groupId>org.apache.camel</groupId>
                                    <artifactId>apache-camel</artifactId>
                                    <version>${camel.version}</version>
                                    <type>tar.gz</type>
                                    <outputDirectory>target/dependencies/camel</outputDirectory>
                                </artifactItem>
                            </artifactItems>
                        </configuration>
                    </execution>
                    <execution>
                        <id>unpack-cxf</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>unpack</goal>
                        </goals>
                        <configuration>
                            <artifactItems>
                                <artifactItem>
                                    <groupId>org.apache.cxf</groupId>
                                    <artifactId>apache-cxf</artifactId>
                                    <version>${cxf.version}</version>
                                    <type>tar.gz</type>
                                    <outputDirectory>target/dependencies/cxf</outputDirectory>
                                </artifactItem>
                            </artifactItems>
                        </configuration>
                    </execution>
                    <execution>
                        <id>unpack-zookeeper</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>unpack</goal>
                        </goals>
                        <configuration>
                            <artifactItems>
                                <artifactItem>
                                    <groupId>org.apache.zookeeper</groupId>
                                    <artifactId>zookeeper</artifactId>
                                    <version>${zookeeper.version}</version>
                                    <type>tar.gz</type>
                                    <outputDirectory>target/dependencies/zookeeper</outputDirectory>
                                </artifactItem>
                            </artifactItems>
                        </configuration>
                    </execution>
                    <execution>
                        <id>unpack-activemq</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>unpack</goal>
                        </goals>
                        <configuration>
                            <!-- must be decompressed twice as apache-activemq tar.gz/zip contents are different -->
                            <artifactItems>
                                <artifactItem>
                                    <groupId>org.apache.activemq</groupId>
                                    <artifactId>apache-activemq</artifactId>
                                    <version>${activemq.version}</version>
                                    <type>tar.gz</type>
                                    <classifier>bin</classifier>
                                    <outputDirectory>target/dependencies/activemq-unix</outputDirectory>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>org.apache.activemq</groupId>
                                    <artifactId>apache-activemq</artifactId>
                                    <version>${activemq.version}</version>
                                    <type>zip</type>
                                    <classifier>bin</classifier>
                                    <outputDirectory>target/dependencies/activemq-win</outputDirectory>
                                </artifactItem>
                            </artifactItems>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <artifactId>maven-antrun-plugin</artifactId>
                <version>1.8</version>
                <executions>
                    <execution>
                        <id>collect-add-ons</id>
                        <phase>generate-resources</phase>
                        <configuration>
                            <target>
                                <patternset id="no.sources.javadoc">
                                    <exclude name="**/target/*-sources.*" />
                                    <exclude name="**/target/*-javadoc.*" />
                                </patternset>
                                <copy todir="target/add-ons/sam">
                                    <fileset dir="${basedir}/../sam">
                                        <include name="**/target/*.jar" />
                                        <include name="**/target/*.war" />
                                        <exclude name="**/sam-example*.*" />
                                        <patternset refid="no.sources.javadoc"/>
                                    </fileset>
                                    <flattenmapper />
                                </copy>
                                <copy todir="target/add-ons/locator">
                                    <fileset dir="${basedir}/../locator">
                                        <include name="**/target/*.jar" />
                                        <include name="**/target/*.war" />
                                        <patternset refid="no.sources.javadoc"/>
                                    </fileset>
                                    <fileset dir="${basedir}/../locator-service">
                                        <include name="**/target/*.jar" />
                                        <patternset refid="no.sources.javadoc"/>
                                    </fileset>
                                    <flattenmapper />
                                </copy>
                                <copy todir="target/add-ons/locator">
                                    <fileset dir="${basedir}/../locator-service/locator-service-common/src/main/resources/model">
                                        <include name="**/*.*" />
                                    </fileset>
                                </copy>
                                <copy todir="target/add-ons/job">
                                    <fileset dir="${basedir}/../job">
                                        <include name="**/target/*.jar" />
                                        <include name="**/target/*.war" />
                                        <patternset refid="no.sources.javadoc"/>
                                    </fileset>
                                    <flattenmapper />
                                </copy>
                                <copy todir="target/add-ons/datasources/sap">
                                    <fileset dir="${basedir}/../talend-sapjco3-connector">
                                        <include name="**/target/*.jar" />
                                        <patternset refid="no.sources.javadoc"/>
                                    </fileset>
                                    <flattenmapper />
                                </copy>
                                <copy todir="target/add-ons/registry/lib">
                                    <fileset dir="${basedir}/../policies">
                                        <include name="**/target/*.jar" />
                                        <include name="**/target/*.war" />
                                        <patternset refid="no.sources.javadoc"/>
                                    </fileset>
                                    <flattenmapper />
                                </copy>
                                <selector id="not.already.in">
                                    <none>
                                        <present targetdir="target/dependencies/camel/apache-camel-${camel.version}/lib">
                                            <mapper type="flatten" />
                                        </present>
                                        <present targetdir="target/dependencies/cxf/apache-cxf-${cxf.version}/lib">
                                            <mapper type="flatten" />
                                        </present>
                                        <present targetdir="target/dependencies/cxf/apache-cxf-${cxf.version}/modules">
                                            <mapper type="flatten" />
                                        </present>
                                        <present targetdir="target/add-ons/sam">
                                            <mapper type="flatten" />
                                        </present>
                                        <present targetdir="target/add-ons/locator">
                                            <mapper type="flatten" />
                                        </present>
                                        <present targetdir="target/add-ons/job">
                                            <mapper type="flatten" />
                                        </present>
                                        <present targetdir="target/add-ons/registry/lib">
                                            <mapper type="flatten" />
                                        </present>
                                    </none>
                                </selector>
                                <copy todir="target/add-ons/lib">
                                    <fileset dir="${basedir}/../sam">
                                        <include name="**/target/dependency/*.jar" />
                                        <selector refid="not.already.in"/>
                                    </fileset>
                                    <fileset dir="${basedir}/../locator">
                                        <include name="**/target/dependency/*.jar" />
                                        <selector refid="not.already.in"/>
                                    </fileset>
                                    <fileset dir="${basedir}/../job">
                                        <include name="**/target/dependency/*.jar" />
                                        <selector refid="not.already.in"/>
                                    </fileset>
                                    <fileset dir="${basedir}/../policies">
                                        <include name="**/target/dependency/*.jar" />
                                        <selector refid="not.already.in"/>
                                    </fileset>
                                    <flattenmapper />
                                </copy>
                            </target>
                        </configuration>
                        <goals>
                            <goal>run</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>patch-features-files</id>
                        <phase>generate-resources</phase>
                        <configuration>
                            <target>
                                <replace file="target/dependencies/standard-${karaf.version}-features.xml">
                                    <replacefilter
                                        token="mvn:org.apache.karaf.config/org.apache.karaf.config.core/${karaf.version}&lt;"
                                        value="mvn:org.apache.karaf.config/org.apache.karaf.config.core/${org.apache.karaf.config.core.tesb.version}&lt;"/>
                                    <replacefilter token="mvn:org.ops4j.pax.web/pax-web-features/7.2.11/xml/features&lt;"
                                                   value="mvn:org.ops4j.pax.web/pax-web-features/${pax-web.version}/xml/features&lt;"/>
                                    <replacefilter>
                                        <replacetoken>feature name="pax-http-service" description="Pax-Web OSGi HTTP Service" version="7.2.11"</replacetoken>
                                        <replacevalue>feature name="pax-http-service" description="Pax-Web OSGi HTTP Service" version="${pax-web.version}"</replacevalue>
                                    </replacefilter>
                                    <replacefilter
                                        token="9.4.20.v20190813"
                                        value="${jetty.version}"/>
                                </replace>
                                <replace file="target/dependencies/framework-${karaf.version}-features.xml">
                                    <replacefilter>
                                        <replacetoken>mvn:org.ops4j.pax.logging/pax-logging-log4j2/1.11.2&lt;</replacetoken>
                                        <replacevalue>mvn:org.ops4j.pax.logging/pax-logging-log4j2/${pax-logging.tesb.version}&lt;</replacevalue>
                                    </replacefilter>
                                </replace>
                                <replace file="target/dependencies/spring-legacy-${karaf.version}-features.xml">
                                    <replacefilter token="mvn:org.ops4j.pax.web/pax-web-features/7.2.11/xml/features&lt;"
                                                   value="mvn:org.ops4j.pax.web/pax-web-features/${pax-web.version}/xml/features&lt;"/>
                                    <replacefilter
                                        token="&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.cglib/3.2.9_1&lt;"
                                        value="&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.cglib/${cglib.bundle.version}&lt;"/>
                                </replace>
                                <!-- patch for pax-logging-*-->
                                <replaceregexp byline="true"
                                        match="^(\s*mvn\\:org\.ops4j\.pax\.logging/pax-logging-\w+/)[-._0-9]+(\s*=.*)$"
                                        replace="\1${pax-logging.tesb.version}\2">
                                    <fileset dir="target/dependencies/apache-karaf/apache-karaf-${karaf.version}/etc/">
                                        <include name="startup.properties"/>
                                    </fileset>
                                </replaceregexp>
                                <replaceregexp byline="true"
                                        match="^(\s*mvn\\:org\.ops4j\.pax\.url/pax-url-\w+/)[-._0-9]+(\s*=.*)$"
                                        replace="\1${pax-url-classpath.version}\2">
                                    <fileset dir="target/dependencies/apache-karaf/apache-karaf-${karaf.version}/etc/">
                                        <include name="startup.properties"/>
                                    </fileset>
                                </replaceregexp>
                                <replace file="target/dependencies/apache-karaf/apache-karaf-${karaf.version}/etc/startup.properties">
                                    <replacefilter
                                        token="mvn\:org.apache.karaf.features/org.apache.karaf.features.core/${karaf.version} = 15"
                                        value="mvn\:org.apache.karaf.features/org.apache.karaf.features.core/${karaf.version} = 15${line.separator}mvn\:com.fasterxml.jackson.core/jackson-core/${jackson.version} = 30${line.separator}mvn\:com.fasterxml.jackson.core/jackson-databind/${jackson-databind.version} = 30${line.separator}mvn\:com.fasterxml.jackson.core/jackson-annotations/${jackson.version} = 30${line.separator}mvn\:org.ops4j.pax.logging/pax-logging-log4j2-extra/${pax-logging.tesb.version} = 30"/>
                                </replace>
                                <replace file="target/dependencies/apache-camel-${camel.version}-features.xml">
                                    <replacefilter
                                        token="apache-cxf/3.2.10/xml/features"
                                        value="apache-cxf/${cxf.version}/xml/features"/>
                                    <replacefilter
                                        token="pax-cdi-features/1.0.0.RC1/xml/features"
                                        value="pax-cdi-features/${pax-cdi.version}/xml/features"/>
                                    <!-- START Update Quartz/C3p0 in Camel - can be removed when we pick up Camel 2.24.3+/2.25.x -->
                                    <replacefilter
                                        token="c3p0/0.9.5.3_1"
                                        value="c3p0/${c3p0.bundle.version}"/>
                                    <replacefilter
                                        token="quartz/2.3.0"
                                        value="quartz/${quartz.version}"/>
                                    <replacefilter
                                        token="HikariCP-java6/2.3.13"
                                        value="HikariCP-java7/${hikaricp.version}"/>
                                    <!-- END Update Quartz/C3p0 in Camel - can be removed when we pick up Camel 2.24.3+/2.25.x -->

                                    <!-- patch for xalan and xerces version -->
                                    <replacefilter>
                                        <replacetoken>&lt;bundle dependency='true'&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.xalan/2.7.2_3&lt;/bundle&gt;</replacetoken>
                                        <replacevalue></replacevalue>
                                    </replacefilter>
                                    <replacefilter>
                                        <replacetoken>&lt;bundle dependency='true'&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.xerces/2.11.0_1&lt;/bundle&gt;</replacetoken>
                                        <replacevalue></replacevalue>
                                    </replacefilter>
                                    <!-- Patch TESB-18685 -->
                                    <replacefilter>
                                        <replacetoken>mvn:org.apache.abdera/abdera-parser/1.1.3</replacetoken>
                                        <replacevalue>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.abdera-parser/1.1.3_2</replacevalue>
                                    </replacefilter>
                                    <!-- Patch the TESB-25669 -->
                                    <replacefilter>
                                        <replacetoken>&lt;bundle dependency='true'&gt;mvn:org.apache.servicemix.specs/org.apache.servicemix.specs.saaj-api-1.3/2.9.0&lt;/bundle&gt;</replacetoken>
                                        <replacevalue></replacevalue>
                                    </replacefilter>
                                    <replacefilter>
                                        <replacetoken>mvn:org.codehaus.woodstox/woodstox-core-asl/4.4.1</replacetoken>
                                        <replacevalue>mvn:com.fasterxml.woodstox/woodstox-core/5.0.3</replacevalue>
                                    </replacefilter>
                                    <replacefilter>
                                        <replacetoken>mvn:org.codehaus.woodstox/woodstox-core-asl/4.3.0</replacetoken>
                                        <replacevalue>mvn:com.fasterxml.woodstox/woodstox-core/5.0.3</replacevalue>
                                    </replacefilter>
                                    <!-- patch the jackson version (TESB-27613) -->
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-core/2.9.9"
                                        value="mvn:com.fasterxml.jackson.core/jackson-core/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-databind/2.9.9.3"
                                        value="mvn:com.fasterxml.jackson.core/jackson-databind/${jackson-databind.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-annotations/2.9.9"
                                        value="mvn:com.fasterxml.jackson.core/jackson-annotations/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-cbor/2.9.9"
                                        value="mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-cbor/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-csv/2.9.9"
                                        value="mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-csv/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-smile/2.9.9"
                                        value="mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-smile/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-xml/2.9.9"
                                        value="mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-xml/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-yaml/2.9.9"
                                        value="mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-yaml/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.datatype/jackson-datatype-guava/2.9.9"
                                        value="mvn:com.fasterxml.jackson.datatype/jackson-datatype-guava/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.datatype/jackson-datatype-jdk8/2.9.9"
                                        value="mvn:com.fasterxml.jackson.datatype/jackson-datatype-jdk8/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.datatype/jackson-datatype-jsr310/2.9.9"
                                        value="mvn:com.fasterxml.jackson.datatype/jackson-datatype-jsr310/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.jaxrs/jackson-jaxrs-base/2.9.9"
                                        value="mvn:com.fasterxml.jackson.jaxrs/jackson-jaxrs-base/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.jaxrs/jackson-jaxrs-json-provider/2.9.9"
                                        value="mvn:com.fasterxml.jackson.jaxrs/jackson-jaxrs-json-provider/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.jr/jackson-jr-objects/2.9.9"
                                        value="mvn:com.fasterxml.jackson.jr/jackson-jr-objects/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.module/jackson-module-afterburner/2.9.9"
                                        value="mvn:com.fasterxml.jackson.module/jackson-module-afterburner/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.module/jackson-module-jaxb-annotations/2.9.9"
                                        value="mvn:com.fasterxml.jackson.module/jackson-module-jaxb-annotations/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.module/jackson-module-jsonSchema/2.9.9"
                                        value="mvn:com.fasterxml.jackson.module/jackson-module-jsonSchema/${jackson.version}"/>
                                    <!-- patch the dom4j version in Camel for TESB-29133-->
                                    <replacefilter
                                        token="mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.dom4j/1.6.1_5"
                                        value="mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.dom4j/${dom4j.bundle.version}"/>
                                    <replacefilter
                                        token="&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.cglib/3.2.9_1&lt;"
                                        value="&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.cglib/${cglib.bundle.version}&lt;"/>
                                </replace>
                                <!-- Patch jetty version range in Camel features (TESB-18114/CAMEL-10433) -->
                                <replaceregexp byline="false" flags="gim"
                                        file="target/dependencies/apache-camel-${camel.version}-features.xml"
                                        match="^(\s*&lt;details&gt;camel-jetty9.*\s*)\s*(\s*&lt;feature&gt;jetty&lt;/feature&gt;)$"
                                        replace="\1&lt;feature version='[9,10)'&gt;jetty&lt;/feature&gt;">
                                </replaceregexp>
                                <replaceregexp byline="false" flags="gim"
                                               file="target/dependencies/apache-camel-${camel.version}-features.xml"
                                               match="^(\s*&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy/([^&lt;]+)&lt;/bundle&gt;)\n\s+(&lt;bundle&gt;mvn:org.apache.camel/camel-groovy/[^&lt;]+&lt;/bundle&gt;)$"
                                               replace="
\1${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-ant/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-cli-commons/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-cli-picocli/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-console/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-datetime/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-docgenerator/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-groovydoc/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-groovysh/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-jmx/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-json/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-macro/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-nio/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-servlet/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-sql/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-swing/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-templates/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-test/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-test-junit5/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-testng/\2&lt;/bundle&gt;${line.separator}
&lt;bundle dependency='true'&gt;mvn:org.codehaus.groovy/groovy-xml/\2&lt;/bundle&gt;${line.separator}
\3">
                                </replaceregexp>
                                <replaceregexp byline="false" flags="gim"
                                               file="target/dependencies/apache-camel-${camel.version}-features.xml"
                                               match="^(\s*&lt;bundle&gt;mvn:org.codehaus.groovy/groovy/([^&lt;]+)&lt;/bundle&gt;)\n\s+(&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-jsr223/[^&lt;]+&lt;/bundle&gt;)$"
                                               replace="
\1${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-ant/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-cli-commons/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-cli-picocli/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-console/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-datetime/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-docgenerator/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-groovydoc/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-groovysh/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-jmx/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-json/\2&lt;/bundle&gt;${line.separator}
\3${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-macro/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-nio/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-servlet/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-sql/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-swing/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-templates/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-test/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-test-junit5/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-testng/\2&lt;/bundle&gt;${line.separator}
&lt;bundle&gt;mvn:org.codehaus.groovy/groovy-xml/\2&lt;/bundle&gt;${line.separator}">
                                </replaceregexp>
                                <replace file="target/dependencies/apache-cxf-${cxf.version}-features.xml">
                                    <!-- patch for xalan and xerces version -->
                                    <replacefilter>
                                        <replacetoken>&lt;bundle start-level="30"&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.xalan/2.7.2_3&lt;/bundle&gt;</replacetoken>
                                        <replacevalue></replacevalue>
                                    </replacefilter>
                                    <replacefilter>
                                        <replacetoken>&lt;bundle start-level="30" dependency="true"&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.xerces/2.11.0_1&lt;/bundle&gt;</replacetoken>
                                        <replacevalue></replacevalue>
                                    </replacefilter>
                                    <!-- Patch used jetty version in CXF (TESB-16331) -->
                                    <replacefilter>
                                        <replacetoken>feature version="[7,10)"&gt;jetty&lt;</replacetoken>
                                        <replacevalue>feature version="[9,10)"&gt;jetty&lt;</replacevalue>
                                    </replacefilter>
                                    <!-- Patch the TESB-23159 -->
                                    <replacefilter>
                                        <replacetoken>mvn:com.fasterxml.woodstox/woodstox-core/5.1.0</replacetoken>
                                        <replacevalue>mvn:com.fasterxml.woodstox/woodstox-core/5.0.3</replacevalue>
                                    </replacefilter>
                                    <replacefilter>
                                        <replacetoken>mvn:org.codehaus.woodstox/stax2-api/4.1</replacetoken>
                                        <replacevalue>mvn:org.codehaus.woodstox/stax2-api/3.1.4</replacevalue>
                                    </replacefilter>
                                    <replacefilter>
                                        <replacetoken>mvn:org.apache.activemq/activemq-osgi/${activemq.version}&lt;</replacetoken>
                                        <replacevalue>mvn:org.apache.activemq/activemq-osgi/${activemq.tesb.version}&lt;</replacevalue>
                                    </replacefilter>
                                    <!-- Patch the TESB-24618 Upgrade CXF 3.3.1 -->
                                    <replacefilter>
                                        <replacetoken>&lt;bundle start-level="10" dependency="true"&gt;mvn:jakarta.xml.bind/jakarta.xml.bind-api/2.3.2&lt;/bundle&gt;</replacetoken>
                                        <replacevalue></replacevalue>
                                    </replacefilter>
                                    <replacefilter>
                                        <replacetoken>&lt;bundle start-level="20"&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxb-runtime/2.3.1_1&lt;/bundle&gt;</replacetoken>
                                        <replacevalue></replacevalue>
                                    </replacefilter>
                                    <replacefilter>
                                        <replacetoken>&lt;bundle start-level="20"&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxb-xjc/2.3.1_1&lt;/bundle&gt;</replacetoken>
                                        <replacevalue></replacevalue>
                                    </replacefilter>
                                    <replacefilter>
                                        <replacetoken>&lt;bundle start-level="20"&gt;mvn:com.sun.istack/istack-commons-runtime/3.0.7&lt;/bundle&gt;</replacetoken>
                                        <replacevalue></replacevalue>
                                    </replacefilter>
                                    <replacefilter>
                                        <replacetoken>&lt;bundle start-level="30" dependency="true"&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.xerces/2.12.0_1&lt;/bundle&gt;</replacetoken>
                                        <replacevalue></replacevalue>
                                    </replacefilter>
                                    <!-- Patch the TESB-25669 -->
                                    <replacefilter>
                                        <replacetoken>&lt;bundle start-level="10" dependency="true"&gt;mvn:org.apache.servicemix.specs/org.apache.servicemix.specs.saaj-api-1.3/2.9.0&lt;/bundle&gt;</replacetoken>
                                        <replacevalue></replacevalue>
                                    </replacefilter>
                                    <replacefilter>
                                        <replacetoken>&lt;bundle start-level="25"&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.saaj-impl/1.3.23_2&lt;/bundle&gt;</replacetoken>
                                        <replacevalue></replacevalue>
                                    </replacefilter>
                                    <replacefilter>
                                        <replacetoken>&lt;bundle start-level="25"&gt;mvn:org.jvnet.staxex/stax-ex/1.7.6&lt;/bundle&gt;</replacetoken>
                                        <replacevalue></replacevalue>
                                    </replacefilter>
                                    <!-- patch the jackson version (TESB-27613) -->
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-core/2.9.10"
                                        value="mvn:com.fasterxml.jackson.core/jackson-core/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-databind/2.9.10"
                                        value="mvn:com.fasterxml.jackson.core/jackson-databind/${jackson-databind.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-annotations/2.9.10"
                                        value="mvn:com.fasterxml.jackson.core/jackson-annotations/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-yaml/2.9.10"
                                        value="mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-yaml/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.module/jackson-module-jaxb-annotations/2.9.10"
                                        value="mvn:com.fasterxml.jackson.module/jackson-module-jaxb-annotations/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.datatype/jackson-datatype-jsr310/2.9.10"
                                        value="mvn:com.fasterxml.jackson.datatype/jackson-datatype-jsr310/${jackson.version}"/>
                                    <!-- patch the dom4j version in CXF for TESB-29133 -->
                                    <replacefilter
                                        token="mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.dom4j/1.6.1_5"
                                        value="mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.dom4j/${dom4j.bundle.version}"/>
                                    <replacefilter
                                            token="mvn:org.apache.cxf/cxf-rt-rs-service-description-swagger/${cxf.version}&lt;"
                                            value="mvn:org.apache.cxf/cxf-rt-rs-service-description-swagger/${cxf-rt-rs-service-description-swagger.tesb.version}&lt;"/>
                                </replace>
                                <!-- patch the cxf-jackson feature (TESB-27214/CXF-8155) -->
                                <replaceregexp byline="false" flags="gim"
                                        file="target/dependencies/apache-cxf-${cxf.version}-features.xml"
                                        match="^(\s*&lt;bundle&gt;wrap:mvn:com.fasterxml.jackson.jaxrs/jackson-jaxrs-base.*\s*)\s*(\s*&lt;/bundle&gt;)$"
                                        replace="&lt;bundle start-level=&quot;35&quot;&gt;mvn:com.fasterxml.jackson.jaxrs/jackson-jaxrs-base/${jackson.version}&lt;/bundle&gt;">
                                </replaceregexp>
                                <replaceregexp byline="false" flags="gim"
                                        file="target/dependencies/apache-cxf-${cxf.version}-features.xml"
                                        match="^(\s*&lt;bundle&gt;wrap:mvn:com.fasterxml.jackson.jaxrs/jackson-jaxrs-json-provider.*\s*)\s*(\s*&lt;/bundle&gt;)$"
                                        replace="&lt;bundle start-level=&quot;35&quot;&gt;mvn:com.fasterxml.jackson.jaxrs/jackson-jaxrs-json-provider/${jackson.version}&lt;/bundle&gt;">
                                </replaceregexp>
                                <replace file="target/dependencies/enterprise-${karaf.version}-features.xml">
                                    <!-- patch the jackson version (TESB-27613) -->
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-core/2.9.9"
                                        value="mvn:com.fasterxml.jackson.core/jackson-core/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-databind/2.9.9"
                                        value="mvn:com.fasterxml.jackson.core/jackson-databind/${jackson-databind.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-annotations/2.9.9"
                                        value="mvn:com.fasterxml.jackson.core/jackson-annotations/${jackson.version}"/>
                                </replace>
                                <replace file="target/dependencies/spring-${karaf.version}-features.xml">
                                    <!-- patch the jackson version (TESB-27613) -->
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-core/2.9.9"
                                        value="mvn:com.fasterxml.jackson.core/jackson-core/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-databind/2.9.9"
                                        value="mvn:com.fasterxml.jackson.core/jackson-databind/${jackson-databind.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-annotations/2.9.9"
                                        value="mvn:com.fasterxml.jackson.core/jackson-annotations/${jackson.version}"/>
                                    <!-- TESB-28029 - remove when we pick up Karaf 4.2.9 -->
                                    <replacefilter
                                        token="5.1.9.RELEASE_1"
                                        value="${spring.bundle.version}"/>
                                    <!-- TESB-28029 end -->
                                </replace>
                                <replace file="target/dependencies/activemq-karaf-${activemq.version}-features-core.xml">
                                    <replacefilter>
                                        <replacetoken>mvn:org.apache.activemq/activemq-osgi/${activemq.version}&lt;</replacetoken>
                                        <replacevalue>mvn:org.apache.activemq/activemq-osgi/${activemq.tesb.version}&lt;</replacevalue>
                                    </replacefilter>
                                    <replacefilter>
                                        <replacetoken>mvn:org.apache.activemq/activemq-karaf/${activemq.version}&lt;</replacetoken>
                                        <replacevalue>mvn:org.apache.activemq/activemq-karaf/${activemq.tesb.version}&lt;</replacevalue>
                                    </replacefilter>
                                    <!-- patch the jackson version (TESB-27613) -->
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-core/2.9.9"
                                        value="mvn:com.fasterxml.jackson.core/jackson-core/${jackson.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-databind/2.9.9"
                                        value="mvn:com.fasterxml.jackson.core/jackson-databind/${jackson-databind.version}"/>
                                    <replacefilter
                                        token="mvn:com.fasterxml.jackson.core/jackson-annotations/2.9.9"
                                        value="mvn:com.fasterxml.jackson.core/jackson-annotations/${jackson.version}"/>
                                </replace>
                                <replace file="target/dependencies/activemq-karaf-${activemq.version}-features.xml">
                                    <!-- patch the jackson version (TESB-27613) -->
                                    <replacefilter>
                                        <replacetoken>mvn:org.apache.activemq/activemq-web-console/${activemq.version}/war</replacetoken>
                                        <replacevalue>mvn:org.apache.activemq/activemq-web-console/${activemq.tesb.version}/war</replacevalue>
                                    </replacefilter>
                                </replace>
                                <!-- patch for decanter bundles (TESB-24788) -->
                                <replace file="target/dependencies/apache-karaf-decanter-${decanter.version}-features.xml">
                                    <replacefilter
                                        token="&gt;mvn:org.apache.karaf.decanter.appender/org.apache.karaf.decanter.appender.jms/${decanter.version}&lt;"
                                        value="&gt;mvn:org.apache.karaf.decanter.appender/org.apache.karaf.decanter.appender.jms/${decanter.version}.tesb1&lt;"/>
                                    <replacefilter
                                        token="&gt;mvn:org.apache.karaf.decanter.appender/org.apache.karaf.decanter.appender.jms/${decanter.version}/cfg&lt;"
                                        value="&gt;mvn:org.apache.karaf.decanter.appender/org.apache.karaf.decanter.appender.jms/${decanter.version}.tesb1/cfg&lt;"/>
                                    <replacefilter
                                        token="&gt;mvn:org.apache.karaf.decanter.collector/org.apache.karaf.decanter.collector.jms/${decanter.version}&lt;"
                                        value="&gt;mvn:org.apache.karaf.decanter.collector/org.apache.karaf.decanter.collector.jms/${decanter.version}.tesb1&lt;"/>
                                    <replacefilter
                                        token="&gt;mvn:org.apache.karaf.decanter.collector/org.apache.karaf.decanter.collector.jms/${decanter.version}/cfg&lt;"
                                        value="&gt;mvn:org.apache.karaf.decanter.collector/org.apache.karaf.decanter.collector.jms/${decanter.version}.tesb1/cfg&lt;"/>
                                </replace>
                                <replace file="target/dependencies/pax-cdi-features-${pax-cdi.version}-features.xml">
                                    <replacefilter
                                        token="&gt;mvn:javax.annotation/javax.annotation-api/1.3.2&lt;"
                                        value="&gt;mvn:jakarta.annotation/jakarta.annotation-api/1.3.5&lt;"/>
                                </replace>
                                <replace file="target/dependencies/pax-jdbc-features-${pax-jdbc.version}-features.xml">
                                    <replacefilter
                                        token="&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.cglib/3.2.4_1&lt;"
                                        value="&gt;mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.cglib/${cglib.bundle.version}&lt;"/>
                                </replace>
                            </target>
                        </configuration>
                        <goals>
                            <goal>run</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>convert-snapshot-file-names</id>
                        <phase>process-resources</phase>
                        <configuration>
                            <target>
                                <!-- convert file names from versioned to non-versioned SNAPSHOTs (TESB-25311) -->
                                <move todir="target/features-repo">
                                    <fileset dir="target/features-repo"/>
                                    <mapper type="regexp" from="^(.*)-[0-9]{8}\.[0-9]{6}-[0-9]*(.*)$$" to="\1-SNAPSHOT\2"/>
                                </move>
                            </target>
                        </configuration>
                        <goals>
                            <goal>run</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>copy-needed-bin-scripts</id>
                        <phase>process-resources</phase>
                        <configuration>
                            <target>
                                <echo message="Copy all bin/* files" />
                                <copy todir="target/container/bin" overwrite="true">
                                    <fileset dir="target/dependencies/apache-karaf/apache-karaf-${karaf.version}/bin">
                                        <include name="contrib/*" />
                                        <include name="client" />
                                        <include name="client.bat" />
                                        <include name="inc" />
                                        <include name="karaf" />
                                        <include name="karaf.bat" />
                                        <include name="setenv" />
                                        <include name="setenv.bat" />
                                        <include name="start" />
                                        <include name="start.bat" />
                                        <include name="stop" />
                                        <include name="stop.bat" />
                                    </fileset>
                                </copy>
                                <echo message="Rename karaf* to trun*" />
                                <move file="target/container/bin/karaf" tofile="target/container/bin/trun" />
                                <move file="target/container/bin/karaf.bat" tofile="target/container/bin/trun.bat" />
                            </target>
                        </configuration>
                        <goals>
                            <goal>run</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>update-bin-scripts</id>
                        <phase>process-resources</phase>
                        <configuration>
                            <target>
                                <ant antfile="src/main/descriptors/bin-build.xml">
                                    <target name="process-bin"/>
                                </ant>
                            </target>
                        </configuration>
                        <goals>
                            <goal>run</goal>
                        </goals>
                    </execution>
                    <!-- need to keep this as repository features still contain <repository> dependencies -->
                    <execution>
                        <id>clean-fork-patched-versions</id>
                        <phase>prepare-package</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <target name="Rename and relocate all fork patch-versioned files">
                                <!-- rename all occurrences of paths having .tesb (from forks) -->
                                <move todir="target/features-repo">
                                    <fileSet dir="target/features-repo"/>
                                    <regexpmapper
                                            from="^(.*)\.tesb[0-9]+(.*)\.tesb[0-9]+(.*)\.(xml|cfg)$"
                                            to="\1\2\3.\4" />
                                </move>
                            </target>
                        </configuration>
                    </execution>
                    <execution>
                        <id>clean-obsolete</id>
                        <phase>prepare-package</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <skip>false</skip>
                            <target name="Clean obsolete dependencies">
                                <delete includeemptydirs="true" verbose="false" failonerror="false">
                                    <fileset dir="target/features-repo/com/fasterxml/jackson" includes="**/2.6.1/**,**/2.11.3/**" />
                                    <fileset dir="target/features-repo/org/eclipse/jetty/aggregate" />
                                    <fileset dir="target/features-repo/org/yaml/snakeyaml/1.17" />
                                    <fileset dir="target/features-repo/org/springframework" />
                                </delete>
                            </target>
                        </configuration>
                    </execution>
                    <execution>
                        <id>clean-empty-dirs</id>
                        <phase>prepare-package</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <target name="Clean empty dirs">
                                <delete includeemptydirs="true" verbose="false">
                                    <fileset dir="target/features-repo">
                                        <patternset>
                                            <include name="**/*" />
                                        </patternset>
                                        <type type="dir" />
                                        <size value="0" when="equal" />
                                    </fileset>
                                </delete>
                            </target>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-assembly-plugin</artifactId>
                <executions>
                    <execution>
                        <id>bin</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                        <configuration>
                            <descriptors>
                                <descriptor>src/main/descriptors/assembly.xml</descriptor>
                            </descriptors>
                            <appendAssemblyId>false</appendAssemblyId>
                            <tarLongFileMode>gnu</tarLongFileMode>
                            <finalName>TESB_SE-V${packages.version}</finalName>
                            <formats>${assembly.formats}</formats>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-pmd-plugin</artifactId>
                <configuration>
                    <skip>true</skip>
                </configuration>
            </plugin>
        </plugins>
    </build>

    <!-- specific profiles for building only tar.gz or zip distributions -->
    <profiles>
        <profile>
            <id>dev-unix-assembly-only</id>
            <properties>
                <assembly.formats>tar.gz</assembly.formats>
            </properties>
        </profile>
        <profile>
            <id>dev-win-assembly-only</id>
            <properties>
                <assembly.formats>zip</assembly.formats>
            </properties>
        </profile>
        <profile>
            <id>dev-dir-assembly-only</id>
            <properties>
                <assembly.formats>dir</assembly.formats>
            </properties>
        </profile>
    </profiles>
</project>

